<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carga de Datos Históricos - Sistema</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-blue: #4f46e5;
            --primary-blue-hover: #4338ca;
            --background-gray: #f8fafc;
            --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .upload-area {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .upload-area.dragover {
            border-color: var(--primary-blue);
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            transition: width 0.3s ease;
            background: linear-gradient(90deg, var(--primary-blue) 0%, #7c3aed 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            border: 1px solid #e2e8f0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #7c3aed 100%);
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
        }
        
        .metric-card {
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
    </style>
</head>
<body class="min-h-screen">
    <header class="dashboard-header text-white py-4 px-6 mb-8">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <h1 class="text-xl font-bold">Sistema</h1>
                <div class="h-6 w-px bg-white/30"></div>
                <span class="text-sm opacity-90">Carga de Datos Históricos</span>
            </div>
            <div class="flex items-center space-x-4">
                <button class="text-white/80 hover:text-white transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-12"></path>
                    </svg>
                </button>
                <span class="text-sm">Usuario Demo</span>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-4 max-w-6xl">
        <div class="mb-8">
            <div class="flex items-center space-x-2 mb-4">
                <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                </svg>
                <h2 class="text-2xl font-bold text-gray-900">Visualización de Datos Históricos</h2>
            </div>
            <p class="text-gray-600">Análisis detallado de la dotación de personal y tendencias históricas</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="metric-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm font-medium">Archivos Cargados</p>
                    <p class="text-2xl font-bold" id="totalFiles">0</p>
                </div>
            </div>
            <div class="metric-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm font-medium">Registros Procesados</p>
                    <p class="text-2xl font-bold" id="totalRecords">0</p>
                </div>
            </div>
            <div class="metric-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm font-medium">Última Carga</p>
                    <p class="text-sm font-medium" id="lastUpload">Sin cargas</p>
                </div>
            </div>
            <div class="metric-card" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                <div class="relative z-10">
                    <p class="text-white/80 text-sm font-medium">Estado</p>
                    <p class="text-sm font-medium">Activo</p>
                </div>
            </div>
        </div>

        <div class="card p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Cargar Archivos</h3>
                    <p class="text-sm text-gray-500">Sube archivos Excel o CSV con datos históricos</p>
                </div>
                <button class="btn-primary text-white px-4 py-2 rounded-lg text-sm font-medium">
                    Nueva Carga
                </button>
            </div>
            
            <div id="uploadArea" class="upload-area rounded-xl p-8 text-center cursor-pointer">
                <div class="mb-4">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>
                <div class="text-lg font-medium text-gray-900 mb-2">
                    Arrastra y suelta tus archivos aquí
                </div>
                <div class="text-sm text-gray-500 mb-4">
                    o <span class="text-indigo-600 font-medium">haz clic para seleccionar</span>
                </div>
                <div class="text-xs text-gray-400">
                    Formatos soportados: Excel (.xlsx, .xls) y CSV (.csv) • Máximo 10MB
                </div>
            </div>
            <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls,.csv" multiple>
        </div>

        <div id="progressSection" class="card p-6 mb-6 hidden">
            <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-medium text-gray-700">Procesando archivo...</span>
                <span id="progressText" class="text-sm text-indigo-600 font-medium">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
                <div id="progressBar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <div id="alertContainer"></div>

        <div class="card">
            <div class="px-6 py-4 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Historial de Cargas</h3>
                        <p class="text-sm text-gray-500">Archivos procesados recientemente</p>
                    </div>
                    <button class="text-indigo-600 hover:text-indigo-700 text-sm font-medium">
                        Ver todos
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div id="uploadHistory" class="space-y-3">
                    <div class="text-center text-gray-500 py-12">
                        <svg class="mx-auto h-12 w-12 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="text-sm font-medium text-gray-900 mb-1">No hay archivos cargados aún</p>
                        <p class="text-xs text-gray-500">Los archivos aparecerán aquí una vez que los subas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class HistoricalDataUploader {
            constructor() {
                this.uploadArea = document.getElementById('uploadArea');
                this.fileInput = document.getElementById('fileInput');
                this.progressSection = document.getElementById('progressSection');
                this.progressBar = document.getElementById('progressBar');
                this.progressText = document.getElementById('progressText');
                this.alertContainer = document.getElementById('alertContainer');
                this.uploadHistory = document.getElementById('uploadHistory');
                this.uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
                
                this.initializeEventListeners();
                this.renderUploadHistory();
                this.updateMetrics();
            }

            initializeEventListeners() {
                this.uploadArea.addEventListener('click', () => {
                    this.fileInput.click();
                });

                this.fileInput.addEventListener('change', (e) => {
                    this.handleFiles(e.target.files);
                });

                this.uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });

                this.uploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                });

                this.uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });
            }

            handleFiles(files) {
                Array.from(files).forEach(file => {
                    if (this.validateFile(file)) {
                        this.uploadFile(file);
                    }
                });
            }

            validateFile(file) {
                const validTypes = [
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'application/vnd.ms-excel',
                    'text/csv'
                ];
                const maxSize = 10 * 1024 * 1024;

                if (!validTypes.includes(file.type) && !file.name.match(/\.(xlsx|xls|csv)$/i)) {
                    this.showAlert('error', `Formato de archivo no válido: ${file.name}. Solo se permiten archivos Excel (.xlsx, .xls) y CSV (.csv).`);
                    return false;
                }

                if (file.size > maxSize) {
                    this.showAlert('error', `El archivo ${file.name} es demasiado grande. El tamaño máximo permitido es 10MB.`);
                    return false;
                }

                return true;
            }

            async uploadFile(file) {
                this.showProgress();
                
                try {
                    for (let progress = 0; progress <= 100; progress += 10) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                        this.updateProgress(progress);
                    }

                    await new Promise(resolve => setTimeout(resolve, 1000));

                    const uploadRecord = {
                        id: Date.now(),
                        name: file.name,
                        size: this.formatFileSize(file.size),
                        uploadDate: new Date().toLocaleString('es-ES'),
                        status: 'success',
                        records: Math.floor(Math.random() * 10000) + 1000
                    };

                    this.uploadedFiles.unshift(uploadRecord);
                    localStorage.setItem('uploadedFiles', JSON.stringify(this.uploadedFiles));

                    this.hideProgress();
                    this.showAlert('success', `¡Archivo "${file.name}" cargado exitosamente! Se procesaron ${uploadRecord.records} registros.`);
                    this.renderUploadHistory();
                    this.updateMetrics();

                } catch (error) {
                    this.hideProgress();
                    this.showAlert('error', `Error al cargar el archivo "${file.name}". Por favor, verifica el formato e intenta nuevamente.`);
                }

                this.fileInput.value = '';
            }

            showProgress() {
                this.progressSection.classList.remove('hidden');
                this.progressSection.classList.add('fade-in');
            }

            hideProgress() {
                this.progressSection.classList.add('hidden');
                this.updateProgress(0);
            }

            updateProgress(progress) {
                this.progressBar.style.width = `${progress}%`;
                this.progressText.textContent = `${progress}%`;
            }

            showAlert(type, message) {
                const alertId = Date.now();
                const alertClass = type === 'success' 
                    ? 'bg-green-50 border-green-200 text-green-800' 
                    : 'bg-red-50 border-red-200 text-red-800';
                
                const iconPath = type === 'success'
                    ? 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'
                    : 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z';

                const alertHTML = `
                    <div id="alert-${alertId}" class="mb-4 p-4 rounded-xl border ${alertClass} fade-in card">
                        <div class="flex items-center">
                            <svg class="h-5 w-5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="${iconPath}" clip-rule="evenodd" />
                            </svg>
                            <span class="font-medium">${message}</span>
                            <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-current opacity-50 hover:opacity-75 transition-opacity">
                                <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `;

                this.alertContainer.insertAdjacentHTML('beforeend', alertHTML);

                setTimeout(() => {
                    const alert = document.getElementById(`alert-${alertId}`);
                    if (alert) alert.remove();
                }, 5000);
            }

            renderUploadHistory() {
                if (this.uploadedFiles.length === 0) {
                    this.uploadHistory.innerHTML = `
                        <div class="text-center text-gray-500 py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <p class="text-sm font-medium text-gray-900 mb-1">No hay archivos cargados aún</p>
                            <p class="text-xs text-gray-500">Los archivos aparecerán aquí una vez que los subas</p>
                        </div>
                    `;
                    return;
                }

                const historyHTML = this.uploadedFiles.map(file => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 hover:bg-gray-100 transition-colors">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                    <svg class="h-5 w-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${file.name}</p>
                                <p class="text-xs text-gray-500">${file.size} • ${file.records.toLocaleString()} registros • ${file.uploadDate}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-medium text-white">
                                Exitoso
                            </span>
                            <button onclick="uploader.removeFile(${file.id})" class="text-gray-400 hover:text-red-500 transition-colors p-1 rounded">
                                <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </div>
                `).join('');

                this.uploadHistory.innerHTML = historyHTML;
            }

            removeFile(fileId) {
                this.uploadedFiles = this.uploadedFiles.filter(file => file.id !== fileId);
                localStorage.setItem('uploadedFiles', JSON.stringify(this.uploadedFiles));
                this.renderUploadHistory();
                this.updateMetrics();
            }

            updateMetrics() {
                const totalFiles = this.uploadedFiles.length;
                const totalRecords = this.uploadedFiles.reduce((sum, file) => sum + file.records, 0);
                const lastUpload = this.uploadedFiles.length > 0 
                    ? new Date(this.uploadedFiles[0].uploadDate).toLocaleDateString('es-ES')
                    : 'Sin cargas';

                document.getElementById('totalFiles').textContent = totalFiles;
                document.getElementById('totalRecords').textContent = totalRecords.toLocaleString();
                document.getElementById('lastUpload').textContent = lastUpload;
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }

        let uploader;
        document.addEventListener('DOMContentLoaded', () => {
            uploader = new HistoricalDataUploader();
        });
    </script>
</body>
</html>
